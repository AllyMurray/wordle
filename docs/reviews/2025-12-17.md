# Wordle Application - Full Code Review

**Date:** December 17, 2025
**Reviewer:** Claude Code
**Repository:** AllyMurray/wordle

---

## Executive Summary

This is a **well-architected, production-ready Wordle clone** with multiplayer P2P capabilities. The codebase demonstrates modern React best practices with Zustand state management, strong TypeScript usage, and thoughtful accessibility features.

**Overall Assessment: High Quality**

| Category | Rating | Notes |
|----------|--------|-------|
| Code Quality | Excellent | Clean, consistent patterns |
| Type Safety | Excellent | Strict TypeScript with Zod validation |
| Testing | Good | 49 tests, stores well-covered |
| Accessibility | Excellent | ARIA labels, screen reader support |
| Performance | Good | React.memo, fine-grained subscriptions |
| Security | Good | Input sanitization, PIN auth |

---

## Technology Stack

| Category | Technology | Purpose |
|----------|-----------|---------|
| **UI Framework** | React 19.2.0 | UI component library with hooks |
| **Language** | TypeScript 5.9.3 | Type safety and IDE support |
| **Build Tool** | Vite 7.2.4 | Fast dev server and production bundler |
| **State Management** | Zustand 5.0.9 | Lightweight state management with fine-grained subscriptions |
| **P2P Networking** | PeerJS 1.5.4 | WebRTC wrapper for peer-to-peer connections |
| **Data Validation** | Zod 4.2.0 | Runtime schema validation for peer messages |
| **Testing** | Vitest 4.0.15 | Fast unit testing framework |
| **Testing Utilities** | @testing-library/react 16.3.0 | React component testing utilities |
| **Linting** | ESLint 9.39.1 | Code quality and style checking |

---

## Strengths

### 1. State Management Architecture

The Zustand store pattern is exemplary:

- **Fine-grained subscriptions** via `subscribeWithSelector` middleware (`src/stores/gameStore.ts:91`)
- **Separation of concerns**: game, multiplayer, stats, and UI stores
- **External access** with `getState()` for WebRTC callbacks
- **Automatic persistence** for statistics via `persist` middleware (`src/stores/statsStore.ts:23-44`)

```typescript
// Example: Fine-grained selector hooks
export const useSolution = () => useGameStore((state) => state.solution);
export const useGuesses = () => useGameStore((state) => state.guesses);
```

### 2. Type Safety

- **Strict TypeScript config** with `noUncheckedIndexedAccess`, `exactOptionalPropertyTypes` (`tsconfig.json:22-23`)
- **Runtime validation** using Zod for peer messages (`src/types.ts:295-413`)
- **Discriminated unions** for type-safe message handling

```typescript
export const PeerMessageSchema = z.discriminatedUnion('type', [
  RequestStateMessageSchema,
  GameStateMessageSchema,
  SuggestWordMessageSchema,
  // ... 12 message types total
]);
```

### 3. Multiplayer Implementation

The P2P networking is sophisticated:

- **Cryptographically secure session codes** with unpredictable peer secrets (`src/types.ts:39-46`)
- **PIN authentication** for optional session protection (`src/stores/multiplayerStore.ts:362-380`)
- **Heartbeat monitoring** with 5s intervals and 15s timeout (`src/stores/multiplayerStore.ts:260-281`)
- **Automatic reconnection** with exponential backoff (`src/stores/multiplayerStore.ts:173-178`)
- **Message acknowledgment** with retry logic (`src/stores/multiplayerStore.ts:180-232`)

### 4. Accessibility

- **Screen reader announcements** via ARIA live regions (`src/components/ScreenReaderAnnouncement.tsx`)
- **Semantic HTML** with proper roles (grid, row, gridcell)
- **Detailed aria-labels** on all interactive elements
- **Keyboard navigation** support

### 5. Input Sanitization

Security-conscious input handling:

- `sanitizeSessionCode()` - filters to allowed characters only (`src/types.ts:84-117`)
- `sanitizeSessionPin()` - numeric only (`src/types.ts:150-156`)
- Validation before use in all cases

### 6. Testing

- **49 passing tests** covering all three stores
- Comprehensive test cases for the letter status algorithm (`src/stores/gameStore.test.ts:229-281`)
- Edge cases covered (duplicate letters, viewer mode, game over states)

---

## Areas for Improvement

### 1. Test Coverage Gaps

**Missing test coverage for:**

- ~~`useGameSession` hook (the main orchestration layer)~~ ✅ **RESOLVED**
- ~~React components (Board, Keyboard, Tile, Row, Lobby, Stats)~~ ✅ **RESOLVED**
- ~~`multiplayerStore.ts` (839 lines with zero tests)~~ ✅ **RESOLVED**
- Integration tests for the P2P flow

**Resolution for useGameSession hook:** Added comprehensive test suite with 41 tests covering:
- Initial return values (game state, multiplayer state, UI state, handler functions)
- Game session actions (handlePlaySolo, handleHost, handleJoin, handleLeave, handleNewGame)
- Keyboard handling for host mode (letter input, backspace, enter, word validation)
- Keyboard handling for viewer mode (suggestion typing, backspace, submit-suggestion return)
- Suggestion handling (accept, reject, send, invalid word detection)
- Role-based properties (isHost, isViewer, game store sync)
- Keyboard event listener management
- Game state callback registration for viewers
- Host game state synchronization when partner connects
- Winning and losing game conditions

**Resolution for multiplayerStore:** Added comprehensive test suite with 39 tests covering:
- Initial state and state management
- Role and connection state transitions
- Host game flow (hosting, PIN authentication, viewer connections)
- Join game flow (validation, authentication, connection handling)
- Session management (leave session, cleanup)
- Suggestion handling (receive, accept, reject, clear)
- Game state synchronization (sending viewer-safe state without solution)
- Message handling (ping/pong, acknowledgments, invalid messages)
- Connection close handling and cleanup
- Selector hooks exports

**Resolution for React components:** Added comprehensive component test suites with 82 tests covering:
- **Tile.test.tsx** (14 tests): Rendering states (empty, filled, status), accessibility (aria-labels), animation delays
- **Row.test.tsx** (12 tests): Empty rows, current input rows, submitted guess rows, shake animation, variable word lengths
- **Board.test.tsx** (12 tests): Grid rendering, accessibility labels, guess display, shake animation propagation, full board states
- **Keyboard.test.tsx** (20 tests): All letter keys, Enter/Backspace, key press handling, status styling, disabled state, wide keys
- **Stats.test.tsx** (24 tests): Visibility, statistics display, distribution bars, close functionality, accessibility, edge cases

~~**Recommendation:** Add integration tests for the P2P flow.~~ ✅ **RESOLVED**

**Resolution for P2P flow integration tests:** Added comprehensive P2P integration test suite with 40 tests covering:
- **Message Validation** (4 tests): All 12 message types validated, invalid messages rejected, game state structure validation, letter status validation
- **Helper Functions** (5 tests): Unique message ID generation, session code format, acknowledgment handling, heartbeat tracking, viewer-safe state creation
- **Authentication Flow** (4 tests): PIN-less connection, PIN format validation, auth success/failure handling
- **Game State Synchronization** (3 tests): Host-to-viewer sync, game over states, multiple guesses with various statuses
- **Suggestion Flow** (6 tests): Viewer sending suggestions, clearing suggestions, host accept/reject, viewer notification, store updates
- **Heartbeat and Connection Health** (5 tests): Ping/pong validation, acknowledgment sending, connection state handling
- **Connection State Management** (4 tests): Host/viewer state tracking, status transitions, session leave/reset
- **Full Game Flow** (4 tests): Complete host-viewer game flow, progressive state updates, PIN authentication flow, suggestion rejection and re-suggestion
- **Error Handling** (5 tests): Invalid message handling, connection failure, partner disconnection, reconnection states, max reconnection attempts

### ~~2. Bundle Size~~ ✅ **RESOLVED**

~~The production bundle is **393 KB** (117 KB gzipped):~~

~~```
dist/assets/index-CTLIcMBg.js   392.99 kB │ gzip: 117.40 kB
```~~

~~Contributing factors:~~
- ~~PeerJS library (~100KB)~~
- ~~Zod library (~40KB)~~
- ~~React/React-DOM (~140KB)~~

**Resolution:** Implemented lazy loading for PeerJS (~100KB):
- Created `peerConnection.ts` module that dynamically imports PeerJS via `loadPeerJS()`
- PeerJS is only loaded when user clicks "Host Game" or "Join Game"
- Bundle is now split into:
  - Main bundle: 307.60 KB (94.43 KB gzipped) - loaded immediately
  - PeerJS chunk: 116.37 KB (31.52 KB gzipped) - loaded on demand
- **Initial load reduced by ~85KB** for users who only play solo games

### ~~3. Hardcoded Timeout in Store~~ ✅ **RESOLVED**

~~At `src/stores/gameStore.ts:118` and `124`:~~

~~The timeout is correctly using a constant, but there's no cleanup mechanism if the component unmounts. This could cause memory leaks or state updates after unmount.~~

**Resolution:** Added `setShakeTimeout` helper function with proper cleanup mechanism:
- Module-level timeout tracking prevents memory leaks
- Existing timeouts are cleared before setting new ones
- `clearShakeTimeout` export allows external cleanup
- `newGame` clears pending timeouts to prevent stale state updates

### ~~4. Module-Level Mutable State~~ ✅ **RESOLVED**

~~In `src/stores/multiplayerStore.ts:101-117`:~~

~~```typescript
const internal: InternalState = {
  peer: null,
  connection: null,
  // ... mutable state outside store
};
```~~

~~This is intentional for PeerJS connection handling but creates implicit coupling. The store is not fully self-contained.~~

**Resolution:** Added comprehensive architectural documentation above the `InternalState` interface in `src/stores/multiplayerStore.ts:80-119` explaining:
- Why this pattern is used (PeerJS objects aren't serializable, WebRTC needs imperative lifecycle management)
- How the pattern works (internal holds infrastructure, Zustand store holds UI-relevant state)
- Tradeoffs (implicit module state, testing considerations, HMR behavior)
- Alternatives considered and why they were rejected

### ~~5. Missing Error Boundaries~~ ✅ **RESOLVED**

~~Only one `ErrorBoundary` component exists, but it's not visible in the component tree. The app could crash from unhandled errors in the game logic.~~

~~**Recommendation:** Wrap key sections (game board, multiplayer panel) in error boundaries.~~

**Resolution:** Enhanced the ErrorBoundary component with:
- Support for customizable `title` and `message` props
- A `compact` mode for inline error boundaries within sections
- An `onError` callback for logging/analytics integration

Added granular error boundaries in `App.tsx` around:
- Game board and keyboard (full-page error boundary with recovery options)
- Multiplayer connection status panel (compact mode)
- Statistics modal (compact mode)

This ensures partial failures don't crash the entire application.

### ~~6. No E2E Tests~~ ✅ **RESOLVED**

~~There are no end-to-end tests for the full user flow.~~

~~**Recommendation:** Add Playwright or Cypress tests for:~~
~~- Solo game completion~~
~~- Host/join multiplayer flow~~
~~- Statistics persistence~~

**Resolution:** Added lightweight integration tests using Vitest + Testing Library instead of heavy E2E frameworks:
- Created `src/integration/gameFlows.test.ts` with 29 comprehensive tests covering:
  - **Solo game completion flow** (9 tests): Winning in 1 guess, multiple guesses, losing after 6 guesses, letter status tracking, backspace handling, invalid/incomplete word rejection, new game after completion, returning to lobby
  - **Statistics persistence** (7 tests): Recording wins/losses, guess distribution tracking, multiplayer vs solo tracking, streak management, win percentage calculation, stats reset
  - **Multiplayer host/join flow** (13 tests): Host/join setup with optional PIN, suggestion handling (send/accept/reject), invalid word detection, session leaving, game state sync, connection status display

This approach provides good coverage of user flows without the maintenance overhead and heavy dependencies of Playwright/Cypress.

### ~~7. CSS Architecture~~ ✅ **RESOLVED**

~~Using vanilla CSS files per component is fine, but lacks:~~
~~- CSS custom properties for theming~~
~~- Design tokens for consistent spacing/colors~~
~~- Scoping mechanism (potential for name collisions)~~

~~The app is dark-mode only with no light mode option.~~

**Resolution:** Implemented comprehensive CSS theming system:
- Added CSS custom properties (design tokens) in `src/index.css` for:
  - Colors (backgrounds, text, borders, semantic status colors)
  - Font sizes and font families
  - Spacing scale (space-1 through space-8)
  - Border radius tokens
  - Transition timing values
  - Z-index layers
- Implemented dark theme (default) and light theme with `data-theme` attribute
- Created `ThemeToggle` component with sun/moon icons for theme switching
- Theme preference persists in localStorage and respects system preference
- Updated all component CSS files to use CSS variables for consistent theming
- Added theme toggle to both the lobby page and game header

---

## Code Quality Observations

### Well-Implemented Patterns

1. **Two-pass letter status algorithm** (`src/stores/gameStore.ts:51-75`) - correctly handles duplicate letters by first marking exact matches, then wrong-position matches.

2. **Computed getters in Zustand** (`src/stores/multiplayerStore.ts:724-732`):
```typescript
get isHost() {
  return get().role === 'host';
}
```

3. **Proper memoization** - All components use `React.memo()` with `displayName` set.

4. **Clean hook return type** (`src/hooks/useGameSession.ts:20-56`) - Well-documented interface for the orchestration hook.

### Minor Issues

1. ~~**Unused types** - `UseWordleOptions`, `UseWordleReturn`, `UseMultiplayerReturn` in `types.ts` appear to be legacy from previous hook-based implementation.~~ ✅ **RESOLVED**
   - Removed unused `UseWordleOptions`, `UseWordleReturn`, and `UseMultiplayerReturn` interfaces from `types.ts`

2. ~~**ESLint disable comment** at `src/hooks/useGameSession.ts:180` for exhaustive deps - could be cleaner with a custom hook.~~ ✅ **RESOLVED**
   - Created `useLatest` hook in `src/hooks/useLatest.ts` to hold stable references
   - Refactored `useGameSession.ts` to use `useLatest` instead of ESLint disable comment

3. ~~**Magic number** in `Stats.tsx:93`~~ ✅ **RESOLVED**
   - Added `GAME_CONFIG.MIN_BAR_WIDTH_PERCENT` constant in `types.ts`
   - Updated `Stats.tsx` to use the constant instead of hardcoded value

---

## Security Assessment

**Strong points:**
- Solution is never sent to viewer (only letter status) - `src/stores/multiplayerStore.ts:756-762`
- Input sanitization on all user inputs
- PIN authentication for sessions
- Zod validation prevents malformed messages

**Considerations:**
- ~~Session codes use `Math.random()` which is not cryptographically secure (`src/stores/multiplayerStore.ts:32-36`)~~ ✅ **RESOLVED**
  - Replaced `Math.random()` with `crypto.getRandomValues()` for session code generation
  - Created reusable `secureRandomString()` helper in `src/types.ts:44-54`
  - Updated `generatePeerSecret()` and `generateReadableCode()` to use cryptographically secure random
- No rate limiting on connection attempts

---

## Architecture Summary

### Store Architecture

| Store | Lines | Purpose |
|-------|-------|---------|
| `gameStore.ts` | 248 | Core game state, letter status algorithm |
| `multiplayerStore.ts` | 839 | P2P connection, WebRTC handling |
| `statsStore.ts` | 63 | Statistics with localStorage persistence |
| `uiStore.ts` | 96 | UI state (game mode, modals, theme) |

### Component Hierarchy

```
App (main orchestrator)
├── ErrorBoundary (error handling)
├── Header
│   ├── Back Button
│   ├── Title (h1)
│   └── Header Actions
│       ├── ThemeToggle (light/dark mode)
│       └── Stats Button
├── ScreenReaderAnnouncement (a11y live region)
├── ConnectionStatus (multiplayer only)
├── Main Content Area
│   ├── Message Display
│   ├── SuggestionPanel (for hosts)
│   ├── Board
│   │   └── Row (x6)
│   │       └── Tile (x5)
│   ├── PlayAgain Button
│   └── Keyboard
└── Stats Modal

Lobby
├── ThemeToggle (top-right corner)
├── Title
├── Subtitle
└── Game Mode Buttons
```

---

## Recommendations Summary

| Priority | Issue | Action |
|----------|-------|--------|
| ~~High~~ | ~~Missing multiplayer tests~~ | ~~Add comprehensive tests for `multiplayerStore.ts`~~ ✅ RESOLVED |
| ~~High~~ | ~~Missing component tests~~ | ~~Add tests for key components~~ ✅ RESOLVED |
| ~~Medium~~ | ~~Bundle size~~ | ~~Lazy load PeerJS for multiplayer mode~~ ✅ RESOLVED |
| ~~Medium~~ | ~~Timer cleanup~~ | ~~Use React-friendly animation approach~~ ✅ RESOLVED |
| ~~Low~~ | ~~Remove unused types~~ | ~~Clean up legacy type definitions~~ ✅ RESOLVED |
| ~~Low~~ | ~~Add CSS custom properties~~ | ~~Improve theme consistency~~ ✅ RESOLVED |

---

## Conclusion

This is a **well-engineered application** that demonstrates strong React and TypeScript skills. The multiplayer implementation is particularly impressive with its reconnection logic, message acknowledgment, and authentication system.

The main areas for improvement are:
1. ~~**Test coverage** for components~~ ✅ **RESOLVED** - Multiplayer store, key components, and useGameSession hook now have comprehensive tests (240 tests total)
2. ~~**Bundle optimization** for faster initial load~~ ✅ **RESOLVED** - PeerJS lazy loading reduces initial bundle by ~85KB
3. ~~**Minor cleanup** of legacy code~~ ✅ **RESOLVED**
4. ~~**CSS architecture** with design tokens and theming~~ ✅ **RESOLVED** - Added CSS custom properties, design tokens, and light/dark mode toggle
5. ~~**End-to-end testing**~~ ✅ **RESOLVED** - Added lightweight integration tests for user flows (29 tests covering solo game, multiplayer, and statistics)

The codebase is production-ready and maintainable. The architecture would scale well for additional features.

---

## Verification Results

```
Tests:     280 passed (12 test files)
Lint:      No errors
TypeCheck: No errors
Build:     Success (426KB JS, 18KB CSS)
```
